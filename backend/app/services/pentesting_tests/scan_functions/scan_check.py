import os
from pathlib import Path
import shutil
import sys
import subprocess

class ScanChecker:
    def __init__(self):
        self.url = None
        self.setting = 'setting.json'
        self.wapiti = True
        self.zap = True
        self.sqlmap = True
        self.XSStrike = True
        self.nmap = True
        self.nikto = True
        self.script_dir = os.path.abspath(os.path.dirname(sys.argv[0]))
    
    def get_folder_path(self, folder):
        current_path = None
        for root, dirs, files in os.walk(os.path.abspath('.')):
            if folder in dirs:
                current_path = os.path.join(root, folder)
                break
        if not current_path:
            print(f"Le dossier {folder} n'a pas été trouvé dans le projet.")
        return  Path(current_path)
    
    def check(self):
        output = subprocess.run("wapiti --version", shell=True, capture_output=True, text=True).stdout.strip("\n")
        if "Wapiti" in output[343:]:
            self.wapiti = True

        self.zap = True
        self.sqlmap = True
        self.XSStrike = True
        self.nmap = True
        self.nikto = True

        return [
            [self.wapiti, "Wapiti {}".format(output[len(output) - 5:])],
            [self.zap, "OWASP ZAP V2.10.0"],
            [self.sqlmap, "sqlmap"],
            [self.XSStrike, "XSStrike"],
            [self.nikto, "nikto"],
            [self.nmap, "nmap"]
        ]

    def configure_new_scan(self, setting, url=None):
        self.setting = setting
        self.url = url