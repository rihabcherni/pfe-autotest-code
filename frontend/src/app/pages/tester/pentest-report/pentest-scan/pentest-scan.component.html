<div class="container-box">
    <app-title [title]="titleValue"></app-title>
    <div class="row">
      <div class="col-12">
        <div class="card shadow-sm">
          <div class="card-body">
            <h6 class="mb-2">Scan URLs in real time to ensure your websites stay secure.</h6>
            <p class="text-secondary">
              Instantly detect XSS, SQL injection, command injection, XXE, and other critical vulnerabilities â€” automatically validated to eliminate false positives.
            </p>
            <ul class="nav nav-tabs" role="tablist">
              <li class="nav-item">
                <a class="nav-link" 
                   [ngClass]="{ active: selectedTab === 'scan' }" 
                   (click)="selectedTab = 'scan'">
                   <i class="fas fa-search me-2"></i>Scan Configuration
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" 
                   [ngClass]="{ active: selectedTab === 'tools' }" 
                   (click)="selectedTab = 'tools'">
                   <i class="fas fa-tools me-2"></i>Select Tools
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" 
                   [ngClass]="{ active: selectedTab === 'advanced' }" 
                   (click)="selectedTab = 'advanced'">
                   <i class="fas fa-cogs me-2"></i>Advanced Options
                </a>
              </li>
            </ul>
            <div class="tab-content mt-4">
              <div *ngIf="selectedTab === 'scan'" class="tab-pane fade show active">
                <form (ngSubmit)="onSubmit()">
                  <div class="mb-2">
                    <label for="urlInput" class="form-label">Target URL</label>
                    <div class="input-group">
                      <span class="input-group-text"><i class="fas fa-globe"></i></span>
                      <input 
                        type="url" 
                        id="urlInput"
                        name="url" 
                        [(ngModel)]="url" 
                        required 
                        class="form-control" 
                        placeholder="https://example.com">
                    </div>
                  </div>
                  <div class="mb-2">
                    <label class="form-label">Authentication Method</label>
                    <div class="d-flex flex-wrap gap-4">
                      <div class="form-check">
                        <input type="radio" 
                          id="noAuth" 
                          name="authMethod" 
                          [(ngModel)]="authMethod" 
                          value="" 
                          class="form-check-input">
                        <label class="form-check-label" for="noAuth">No Authentication</label>
                      </div>
                      <div class="form-check">
                        <input type="radio" 
                          id="passwordAuth" 
                          name="authMethod" 
                          [(ngModel)]="authMethod" 
                          value="password" 
                          class="form-check-input">
                        <label class="form-check-label" for="passwordAuth">Username & Password</label>
                      </div>
                      <div class="form-check">
                        <input type="radio" 
                          id="tokenAuth" 
                          name="authMethod" 
                          [(ngModel)]="authMethod" 
                          value="token" 
                          class="form-check-input">
                        <label class="form-check-label" for="tokenAuth">Token</label>
                      </div>
                      <div class="form-check">
                        <input type="radio" 
                          id="cookiesAuth" 
                          name="authMethod" 
                          [(ngModel)]="authMethod" 
                          value="cookies" 
                          class="form-check-input">
                        <label class="form-check-label" for="cookiesAuth">Cookies</label>
                      </div>
                    </div>
                  </div>                  
                  <div *ngIf="authMethod === 'password'" class="row mb-2">
                    <div class="col-md-6 mb-2 mb-md-0">
                      <label for="username" class="form-label">Username</label>
                      <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user"></i></span>
                        <input type="text" id="username" name="username" [(ngModel)]="username" class="form-control" placeholder="Username">
                      </div>
                    </div>
                    <div class="col-md-6">
                      <label for="password" class="form-label">Password</label>
                      <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-lock"></i></span>
                        <input type="password" id="password" name="password" [(ngModel)]="password" class="form-control" placeholder="Password">
                      </div>
                    </div>
                  </div>
                  
                  <div *ngIf="authMethod === 'token'" class="mb-2">
                    <label for="token" class="form-label">Authentication Token</label>
                    <div class="input-group">
                      <span class="input-group-text"><i class="fas fa-key"></i></span>
                      <input type="text" id="token" name="token_auth" [(ngModel)]="token_auth" class="form-control" placeholder="Bearer token">
                    </div>
                  </div>
                  <div *ngIf="authMethod === 'cookies'" class="mb-2">
                    <label for="cookies" class="form-label">Cookies</label>
                    <div class="input-group">
                      <span class="input-group-text"><i class="fas fa-cookie"></i></span>
                      <textarea id="cookies" name="cookies" [(ngModel)]="cookies" class="form-control" placeholder="cookies..."></textarea>
                    </div>
                  </div>
                  <div class="d-grid mt-4">
                    <button class="btn btn-primary" type="submit" [disabled]="scanInProgress">
                      <i class="fas fa-search me-2"></i>
                      {{ scanInProgress ? 'Scan in progress...' : 'Start Scanning' }}
                    </button>
                  </div>
                  <div *ngIf="scanInProgress" class="alert alert-warning mt-2">
                    <i class="fas fa-spinner fa-spin me-2"></i> A scan is already running. Please wait until it completes.
                  </div>
                  <div *ngIf="errorMessage" class="alert alert-danger mt-3">
                    <i class="fas fa-exclamation-circle me-2"></i> {{ errorMessage }}
                  </div>
                  <div *ngIf="successMessage" class="alert alert-success mt-3">
                    <i class="fas fa-check-circle me-2"></i> {{ successMessage }}
                  </div>
                </form>
              </div>              
              <div *ngIf="selectedTab === 'tools'" class="tab-pane fade show active">
                <div class="mb-2">
                  <div class="d-flex justify-content-between align-items-center">
                    <p class="mb-2 form-label">Select Scanning Tools</p>
                    <div class="mb-2"> 
                      <button class="btn btn-sm me-2" [ngClass]="{
                          'btn-outline-primary': selectedButton !== 'select',
                          'btn-primary text-white': selectedButton === 'select'
                        }" (click)="selectAllTools()">Select All
                      </button>
                      <button class="btn btn-sm" [ngClass]="{
                          'btn-outline-primary': selectedButton !== 'deselect',
                          'btn-primary text-white': selectedButton === 'deselect'
                        }" (click)="deselectAllTools()">Deselect All
                      </button>
                    </div>
                  </div>
                  <div class="tool-grid d-flex flex-wrap justify-content-start gap-3">
                    <div class="tool-item" *ngFor="let tool of scanTools">
                      <div class="card h-100 tool-card text-center p-2"
                          [ngClass]="{ 'selected': tool.selected }"
                          (click)="toggleToolSelection(tool)"
                          style="cursor: pointer;">
                        <div class="form-check text-end d-none">
                          <input class="form-check-input" type="checkbox"
                                [id]="'tool-' + tool.id"
                                [(ngModel)]="tool.selected"
                                name="selectedTools">
                        </div>
                        <div class="tool-icon mb-1">
                          <img [src]="tool.iconUrl" [alt]="tool.name + ' icon'" class="img-fluid" [width]="tool.width">
                        </div>
                        <h6 class="card-title">{{ tool.name }}</h6>
                        <p class="card-text extra-small-text text-muted">{{ tool.description }}</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>              
              <div *ngIf="selectedTab === 'advanced'" class="tab-pane fade show active">
                <div *ngIf="securityPreferencesLoading" class="text-center py-4">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                  <p class="mt-2">Loading advanced options...</p>
                </div>                
                <div *ngIf="!securityPreferencesLoading" class="row options-box">
                  <div class="d-flex justify-content-end gap-1">
                    <button class="btn btn-outline-secondary" type="button" (click)="resetSecurityPreferences()" 
                            [disabled]="securityPreferencesLoading || securityPreferencesSaving">
                      <i class="fas fa-undo me-2"></i> Reset to Defaults
                    </button>
                    <button class="btn btn-primary" type="button" (click)="saveSecurityPreferences()" 
                            [disabled]="securityPreferencesLoading || securityPreferencesSaving">
                      <i class="fas fa-save me-2"></i>
                      {{ securityPreferencesSaving ? 'Saving...' : 'Save Options' }}
                    </button>
                  </div>
                  <div *ngIf="errorMessage && selectedTab === 'advanced'" class="alert alert-danger mt-3">
                    <i class="fas fa-exclamation-circle me-2"></i> {{ errorMessage }}
                  </div>
                  <div *ngIf="successMessage && selectedTab === 'advanced'" class="alert alert-success mt-3">
                    <i class="fas fa-check-circle me-2"></i> {{ successMessage }}
                  </div>
                  <div class="col-12 mb-1">
                    <h6 class="text-primary mb-1"><i class="fas fa-cog me-2"></i>General Options</h6>
                    <div class="row">
                      <div class="col-md-4 mb-2">
                        <label for="threads" class="form-label">Number of Threads</label>
                        <input type="number" id="threads" class="form-control" [(ngModel)]="threads" min="1" max="10">
                        <small class="form-text text-muted">Number of concurrent threads (1-10)</small>
                      </div>
                      <div class="col-md-4 mb-2">
                        <label for="depth_crawl" class="form-label">Crawl Depth</label>
                        <input type="number" id="depth_crawl" class="form-control" 
                               [class]="getFieldValidationClass('depth_crawl', securityPreferences.depth_crawl)"
                               [(ngModel)]="securityPreferences.depth_crawl" min="1" max="10">
                        <div *ngIf="hasValidationError('depth_crawl', securityPreferences.depth_crawl)" 
                             class="invalid-feedback d-block">
                          {{ getValidationErrorMessage('depth_crawl', securityPreferences.depth_crawl) }}
                        </div>
                        <small class="form-text text-muted">Website crawling depth (1-10)</small>
                      </div>
                      <div class="col-md-4 mb-2">
                        <label for="crawl" class="form-label">Enable Crawling</label>
                        <select id="crawl" class="form-control" [(ngModel)]="crawl">
                          <option [value]="true">Yes</option>
                          <option [value]="false">No</option>
                        </select>
                        <small class="form-text text-muted">Enable/disable website crawling</small>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-6 mb-1">
                      <h6 class="text-primary mb-1"><i class="fas fa-shield-alt me-2"></i>ZAP Scanner Options</h6>
                      <div class="row">
                        <div class="col-md-6 mb-1">
                          <label for="zap_dc" class="form-label">ZAP Directory Check</label>
                          <input type="number" 
                                id="zap_dc" 
                                class="form-control" 
                                [class]="getFieldValidationClass('zap_dc', securityPreferences.zap_dc)"
                                [(ngModel)]="securityPreferences.zap_dc" 
                                min="1" 
                                max="10">
                          <div *ngIf="hasValidationError('zap_dc', securityPreferences.zap_dc)" 
                              class="invalid-feedback d-block">
                            {{ getValidationErrorMessage('zap_dc', securityPreferences.zap_dc) }}
                          </div>
                          <small class="form-text text-muted">Directory check level (1-10)</small>
                        </div>
                        <div class="col-md-6 mb-1">
                          <label for="zap_d" class="form-label">ZAP Depth</label>
                          <input type="number" id="zap_d" 
                                class="form-control" [class]="getFieldValidationClass('zap_d', securityPreferences.zap_d)"
                                [(ngModel)]="securityPreferences.zap_d" min="1" max="10">
                          <div *ngIf="hasValidationError('zap_d', securityPreferences.zap_d)" 
                              class="invalid-feedback d-block">
                            {{ getValidationErrorMessage('zap_d', securityPreferences.zap_d) }}
                          </div>
                          <small class="form-text text-muted">Scan depth level (1-10)</small>
                        </div>
                      </div>
                    </div>
                    <div class="col-6 mb-1">
                      <h6 class="text-primary mb-1"><i class="fas fa-bug me-2"></i>Wapiti Scanner Options</h6>
                      <div class="row">
                        <div class="col-md-6 mb-2">
                          <label for="wapiti_scan_time" class="form-label">Scan Time (minutes)</label>
                          <input type="number" 
                                id="wapiti_scan_time" 
                                class="form-control" 
                                [class]="getFieldValidationClass('wapiti_scan_time', securityPreferences.wapiti_scan_time)"
                                [(ngModel)]="securityPreferences.wapiti_scan_time" 
                                min="1" 
                                max="60">
                          <div *ngIf="hasValidationError('wapiti_scan_time', securityPreferences.wapiti_scan_time)" 
                              class="invalid-feedback d-block">
                            {{ getValidationErrorMessage('wapiti_scan_time', securityPreferences.wapiti_scan_time) }}
                          </div>
                          <small class="form-text text-muted">Maximum scan time in minutes (1-60)</small>
                        </div>
                        <div class="col-md-6 mb-2">
                          <label for="wapiti_level" class="form-label">Wapiti Level</label>
                          <select id="wapiti_level" 
                                  class="form-control" 
                                  [class]="getFieldValidationClass('wapiti_level', securityPreferences.wapiti_level)"
                                  [(ngModel)]="securityPreferences.wapiti_level">
                            <option [value]="1">Level 1 - Basic</option>
                            <option [value]="2">Level 2 - Advanced</option>
                          </select>
                          <div *ngIf="hasValidationError('wapiti_level', securityPreferences.wapiti_level)" 
                              class="invalid-feedback d-block">
                            {{ getValidationErrorMessage('wapiti_level', securityPreferences.wapiti_level) }}
                          </div>
                          <small class="form-text text-muted">Scanning intensity level</small>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-12 mb-1">
                    <h6 class="text-primary mb-1"><i class="fas fa-database me-2"></i>SQLMap Options</h6>
                    <div class="row">
                      <div class="col-md-3 mb-2">
                        <label for="sqlmap_level" class="form-label">SQLMap Level</label>
                        <select id="sqlmap_level" 
                                class="form-control" 
                                [class]="getFieldValidationClass('sqlmap_level', securityPreferences.sqlmap_level)"
                                [(ngModel)]="securityPreferences.sqlmap_level">
                          <option [value]="1">Level 1</option>
                          <option [value]="2">Level 2</option>
                          <option [value]="3">Level 3</option>
                          <option [value]="4">Level 4</option>
                          <option [value]="5">Level 5</option>
                        </select>
                        <div *ngIf="hasValidationError('sqlmap_level', securityPreferences.sqlmap_level)" 
                             class="invalid-feedback d-block">
                          {{ getValidationErrorMessage('sqlmap_level', securityPreferences.sqlmap_level) }}
                        </div>
                        <small class="form-text text-muted">Test level (1-5)</small>
                      </div>
                      <div class="col-md-3 mb-2">
                        <label for="sqlmap_risk" class="form-label">SQLMap Risk</label>
                        <select id="sqlmap_risk" 
                                class="form-control" 
                                [class]="getFieldValidationClass('sqlmap_risk', securityPreferences.sqlmap_risk)"
                                [(ngModel)]="securityPreferences.sqlmap_risk">
                          <option [value]="1">Risk 1 - Safe</option>
                          <option [value]="2">Risk 2 - Medium</option>
                          <option [value]="3">Risk 3 - High</option>
                        </select>
                        <div *ngIf="hasValidationError('sqlmap_risk', securityPreferences.sqlmap_risk)" 
                             class="invalid-feedback d-block">
                          {{ getValidationErrorMessage('sqlmap_risk', securityPreferences.sqlmap_risk) }}
                        </div>
                        <small class="form-text text-muted">Risk level (1-3)</small>
                      </div>
                      <div class="col-md-3 mb-2">
                        <label for="sqlmap_threads" class="form-label">SQLMap Threads</label>
                        <input type="number" 
                               id="sqlmap_threads" class="form-control" [class]="getFieldValidationClass('sqlmap_threads', securityPreferences.sqlmap_threads)"
                               [(ngModel)]="securityPreferences.sqlmap_threads" min="1" max="20">
                        <div *ngIf="hasValidationError('sqlmap_threads', securityPreferences.sqlmap_threads)" 
                             class="invalid-feedback d-block">
                          {{ getValidationErrorMessage('sqlmap_threads', securityPreferences.sqlmap_threads) }}
                        </div>
                        <small class="form-text text-muted">Number of threads (1-20)</small>
                      </div>
                      <div class="col-md-3 mb-2">
                        <label for="sqlmap_technique" class="form-label">SQLMap Technique</label>
                        <input type="text" id="sqlmap_technique" class="form-control" 
                               [class]="getFieldValidationClass('sqlmap_technique', securityPreferences.sqlmap_technique)"
                               [(ngModel)]="securityPreferences.sqlmap_technique" placeholder="BEUSTQ">
                        <div *ngIf="hasValidationError('sqlmap_technique', securityPreferences.sqlmap_technique)" 
                             class="invalid-feedback d-block">
                          {{ getValidationErrorMessage('sqlmap_technique', securityPreferences.sqlmap_technique) }}
                        </div>
                        <small class="form-text text-muted">Injection techniques</small>
                      </div>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-4 mb-1">
                      <h6 class="text-primary mb-1"><i class="fas fa-search me-2"></i>Nikto Scanner Options</h6>
                      <div class="row">
                        <div class="col-md-12 mb-2">
                          <label for="nikto_timeout" class="form-label">Nikto Timeout (seconds)</label>
                          <input type="number" id="nikto_timeout" class="form-control" [class]="getFieldValidationClass('nikto_timeout', securityPreferences.nikto_timeout)"
                                [(ngModel)]="securityPreferences.nikto_timeout" min="60" max="3600">
                          <div *ngIf="hasValidationError('nikto_timeout', securityPreferences.nikto_timeout)" 
                              class="invalid-feedback d-block">
                            {{ getValidationErrorMessage('nikto_timeout', securityPreferences.nikto_timeout) }}
                          </div>
                          <small class="form-text text-muted">Request timeout in seconds (60-3600)</small>
                        </div>
                      </div>
                    </div>
                    <div class="col-4 mb-1">
                      <h6 class="text-primary mb-1"><i class="fas fa-bolt me-2"></i>Nuclei Scanner Options</h6>
                      <div class="row">
                        <div class="col-md-12 mb-2">
                          <label for="nuclei_rate_limit" class="form-label">Nuclei Rate Limit</label>
                          <input type="number" 
                                id="nuclei_rate_limit" 
                                class="form-control" 
                                [class]="getFieldValidationClass('nuclei_rate_limit', securityPreferences.nuclei_rate_limit)"
                                [(ngModel)]="securityPreferences.nuclei_rate_limit" 
                                min="10" 
                                max="1000">
                          <div *ngIf="hasValidationError('nuclei_rate_limit', securityPreferences.nuclei_rate_limit)" 
                              class="invalid-feedback d-block">
                            {{ getValidationErrorMessage('nuclei_rate_limit', securityPreferences.nuclei_rate_limit) }}
                          </div>
                          <small class="form-text text-muted">Requests per second (10-1000)</small>
                        </div>
                      </div>
                    </div>
                    <div class="col-4 mb-1">
                      <h6 class="text-primary mb-1"><i class="fas fa-network-wired me-2"></i>Nmap Scanner Options</h6>
                      <div class="row">
                        <div class="col-md-12 mb-2">
                          <label for="nmap_timing" class="form-label">Nmap Timing</label>
                          <select id="nmap_timing" 
                                  class="form-control" 
                                  [class]="getFieldValidationClass('nmap_timing', securityPreferences.nmap_timing)"
                                  [(ngModel)]="securityPreferences.nmap_timing">
                            <option [value]="0">T0 - Paranoid</option>
                            <option [value]="1">T1 - Sneaky</option>
                            <option [value]="2">T2 - Polite</option>
                            <option [value]="3">T3 - Normal</option>
                            <option [value]="4">T4 - Aggressive</option>
                            <option [value]="5">T5 - Insane</option>
                          </select>
                          <div *ngIf="hasValidationError('nmap_timing', securityPreferences.nmap_timing)" 
                              class="invalid-feedback d-block">
                            {{ getValidationErrorMessage('nmap_timing', securityPreferences.nmap_timing) }}
                          </div>
                          <small class="form-text text-muted">Timing template (0-5)</small>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-6 mb-1">
                      <h6 class="text-primary mb-1"><i class="fas fa-globe me-2"></i>WhatWeb Scanner Options</h6>
                      <div class="row">
                        <div class="col-md-12 mb-2">
                          <label for="whatweb_aggression" class="form-label">WhatWeb Aggression</label>
                          <select id="whatweb_aggression" 
                                  class="form-control" 
                                  [class]="getFieldValidationClass('whatweb_aggression', securityPreferences.whatweb_aggression)"
                                  [(ngModel)]="securityPreferences.whatweb_aggression">
                            <option [value]="1">Level 1 - Stealthy</option>
                            <option [value]="2">Level 2 - Unused</option>
                            <option [value]="3">Level 3 - Aggressive</option>
                            <option [value]="4">Level 4 - Heavy</option>
                          </select>
                          <div *ngIf="hasValidationError('whatweb_aggression', securityPreferences.whatweb_aggression)" 
                              class="invalid-feedback d-block">
                            {{ getValidationErrorMessage('whatweb_aggression', securityPreferences.whatweb_aggression) }}
                          </div>
                          <small class="form-text text-muted">Aggression level (1-4)</small>
                        </div>
                      </div>
                    </div>
                    <div class="col-6 mb-1">
                      <h6 class="text-primary mb-1"><i class="fas fa-code me-2"></i>PwnXSS Scanner Options</h6>
                      <div class="row">
                        <div class="col-md-12 mb-2">
                          <label for="pwnxss_threads" class="form-label">PwnXSS Threads</label>
                          <input type="number" 
                                id="pwnxss_threads" 
                                class="form-control" 
                                [class]="getFieldValidationClass('pwnxss_threads', securityPreferences.pwnxss_threads)"
                                [(ngModel)]="securityPreferences.pwnxss_threads" 
                                min="1" 
                                max="50">
                          <div *ngIf="hasValidationError('pwnxss_threads', securityPreferences.pwnxss_threads)" 
                              class="invalid-feedback d-block">
                            {{ getValidationErrorMessage('pwnxss_threads', securityPreferences.pwnxss_threads) }}
                          </div>
                          <small class="form-text text-muted">Number of threads (1-50)</small>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>         
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>